(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{348:function(e,t,n){e.exports=n.p+"assets/img/phantom-hints.64e934b6.png"},349:function(e,t,n){e.exports=n.p+"assets/img/phantom-pmt.8d872436.png"},384:function(e,t,n){"use strict";n.r(t);var o=n(7),a=Object(o.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("Introducing phantom node payments, a new-ish feature for LDK.")]),e._v(" "),t("p",[e._v("Phantom node payments let enterprise users running high-volume lightning nodes generate invoices that can be paid to one of multiple production nodes. Since it’s safe to assume that payers will retry along an alternate route hint if one fails, phantom payments allow for load balancing between nodes and resilience if a node or nodes go down.")]),e._v(" "),t("h2",{attrs:{id:"phantom-payment-flow"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#phantom-payment-flow"}},[e._v("#")]),e._v(" Phantom Payment Flow")]),e._v(" "),t("p",[e._v("Using LNMerchant as an example company, here’s how phantom payments work:")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Buyer on the Lightning Network requests an invoice")])]),e._v(" "),t("li",[t("p",[e._v("LNMerchant replies with an invoice. Per standard invoice protocol, it contains information on routing to LNMerchant. However, unlike conventional invoice route hints, phantom route hints include a combination of real and fake routing information. This fake or “phantom” routing information will later signal to LDK that the payment’s intended destination is a phantom node.")])])]),e._v(" "),t("p",[e._v("The following illustration demonstrates how phantom route hints work:")]),e._v(" "),t("figure",[t("img",{attrs:{src:n(348),alt:"Phantom Hints"}})]),e._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[e._v("The buyer’s node generates a normal route. Using the route hints, the last two hops are [LNMerchantNode, PhantomNode], i.e., the phantom node is the destination node, and the second-to-last hop is an actual LNMerchant node. (Note: If the LNMerchant has public channels, only the last hop containing the fake channel is strictly necessary for the route hints.)")])]),e._v(" "),t("p",[e._v("The buyer uses this route, including the fake forwarding information from the route hints, to generate the payment onion. On Lightning, each hop along the route unwraps one layer of sender-constructed onion.")]),e._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[t("p",[e._v("The buyer forwards the payment to the route’s first hop, which gets forwarded through intermediate hops.")])]),e._v(" "),t("li",[t("p",[e._v("The payment forwards to the second-to-last hop, an actual LNMerchant node.")])]),e._v(" "),t("li",[t("p",[e._v("The LNMerchant node checks what channel to forward the payment to and recognizes a phantom channel ID.")])]),e._v(" "),t("li",[t("p",[e._v("The LNMerchant node knows the phantom node’s secret key, so it can unwrap the last layer of the onion and verify the payment details. It also knows the preimage for the payment, so it can claim the amount owed without forwarding the payment to the non-existent phantom.")])])]),e._v(" "),t("figure",[t("img",{attrs:{src:n(349),alt:"Phantom PMT"}})]),e._v(" "),t("h2",{attrs:{id:"why-it-s-ok-to-not-support-mpp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#why-it-s-ok-to-not-support-mpp"}},[e._v("#")]),e._v(" Why It’s OK to Not Support MPP")]),e._v(" "),t("p",[e._v("One potential drawback to phantom node payments is the lack of multi-path payments (MPP) support.")]),e._v(" "),t("p",[e._v("MPP payments benefit large transactions because they aren’t restricted to routes where each channel must carry its entire payment balance.")]),e._v(" "),t("p",[e._v("With this in mind, a compelling compromise is to:")]),e._v(" "),t("ul",[t("li",[e._v("Create MPP-supporting invoices against a single node for large payments.")]),e._v(" "),t("li",[e._v("Create phantom invoices for smaller payments, which are the most common and are unlikely to use MPP.")])]),e._v(" "),t("h2",{attrs:{id:"why-mpp-shouldn-t-be-enabled"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#why-mpp-shouldn-t-be-enabled"}},[e._v("#")]),e._v(" Why MPP Shouldn’t Be Enabled")]),e._v(" "),t("p",[e._v("Let’s say that we want to implement MPP for phantom payments. In this case, each real LNMerchant node may receive a slice of the phantom node-destined phantom payment. In this case, the question becomes: How do real nodes know when a payment is accepted across all nodes so that it’s safe to release the preimage?")]),e._v(" "),t("p",[e._v("On the surface, it seems like users should be able to tell LDK when a payment has been received across all nodes and is safe to claim. However, this would significantly compromise our safety guarantees because releasing the preimage before receiving the total payment value opens up the possibility for intermediate nodes to claim remaining payment parts. Moreover, implementing this would introduce perilous race conditions, because users would need to “lock” internal LDK data structures to ensure payment claims are atomic. Failing to properly handle these delicate cases would lead to force-closed channels and possibly lost funds.")]),e._v(" "),t("hr"),e._v(" "),t("p",[e._v("Thanks for taking the time to learn about phantom nodes and payments. We think it’s an exciting showcase for the lightning protocol’s flexibility and variety of use cases.")]),e._v(" "),t("p",[e._v("Want to make your own contribution to LDK? Join us on GitHub at our "),t("a",{attrs:{href:"https://github.com/lightningdevkit/",target:"_blank",rel:"noopener noreferrer"}},[e._v("LDK repo"),t("OutboundLink")],1),e._v(".")])])}),[],!1,null,null,null);t.default=a.exports}}]);