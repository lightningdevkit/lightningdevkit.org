<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Fee Estimation | Lightning Dev Kit Documentation</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="preload" href="/fonts/ibm-plex-mono-400.woff2" as="font" crossorigin="true">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="/css/variables.css">
    <link name="msapplication-config" content="/browserconfig.xml">
    <link name="msapplication-TileColor" content="#ffffff">
    <link name="theme-color" content="#ffffff">
    <meta name="description" content="LDK is a flexible lightning implementation with supporting batteries (or modules).">
    <meta property="og:site_name" content="Lightning Dev Kit Documentation">
    <meta property="og:title" content="Fee Estimation">
    <meta property="og:description" content="LDK provides a ```FeeEstimator``` trait which, once implemented, assists in variety of on-chain and off-chain tasks. It&#39;s important to note that the ```FeeEstimator``` only describes the architectural requirements that must be satisfied to successfully incorporate LDK into your project. It does not, itself, provide the logic or implementation to calculate a feerate. ">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://lightningdevkit.org/fee_estimation/">
    <meta property="og:image" content="https://lightningdevkit.org/card.png">
    <meta name="twitter:title" content="Fee Estimation">
    <meta name="twitter:description" content="LDK provides a ```FeeEstimator``` trait which, once implemented, assists in variety of on-chain and off-chain tasks. It&#39;s important to note that the ```FeeEstimator``` only describes the architectural requirements that must be satisfied to successfully incorporate LDK into your project. It does not, itself, provide the logic or implementation to calculate a feerate. ">
    <meta name="twitter:url" content="https://lightningdevkit.org/fee_estimation/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="https://lightningdevkit.org/card.png">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="Bitcoin, Lightning, LDK, Lightning Dev Kit, Documentation">
    <meta property="article:tag" content="Bitcoin">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    
    <link rel="preload" href="/assets/css/0.styles.097f5d83.css" as="style"><link rel="preload" href="/assets/js/app.6bc2205c.js" as="script"><link rel="preload" href="/assets/js/10.e6e8a98f.js" as="script"><link rel="preload" href="/assets/js/1.849294d7.js" as="script"><link rel="preload" href="/assets/js/62.73904824.js" as="script"><link rel="prefetch" href="/assets/js/11.4bdcd21b.js"><link rel="prefetch" href="/assets/js/12.5ca28d3f.js"><link rel="prefetch" href="/assets/js/13.bfbe2001.js"><link rel="prefetch" href="/assets/js/14.6cfb4db4.js"><link rel="prefetch" href="/assets/js/15.d3853dcf.js"><link rel="prefetch" href="/assets/js/16.2a376263.js"><link rel="prefetch" href="/assets/js/17.a14ed725.js"><link rel="prefetch" href="/assets/js/18.b162d8ed.js"><link rel="prefetch" href="/assets/js/19.12338ec7.js"><link rel="prefetch" href="/assets/js/20.17377d70.js"><link rel="prefetch" href="/assets/js/21.8c8f3cf6.js"><link rel="prefetch" href="/assets/js/22.a2db3f3a.js"><link rel="prefetch" href="/assets/js/23.5b7252de.js"><link rel="prefetch" href="/assets/js/24.28b3e164.js"><link rel="prefetch" href="/assets/js/25.663af32d.js"><link rel="prefetch" href="/assets/js/26.e141c31c.js"><link rel="prefetch" href="/assets/js/27.f179fa88.js"><link rel="prefetch" href="/assets/js/28.3e31931e.js"><link rel="prefetch" href="/assets/js/29.4c8d58f1.js"><link rel="prefetch" href="/assets/js/30.20eced78.js"><link rel="prefetch" href="/assets/js/31.3bea1c16.js"><link rel="prefetch" href="/assets/js/32.1b1b5ce5.js"><link rel="prefetch" href="/assets/js/33.b903c57b.js"><link rel="prefetch" href="/assets/js/34.e1711435.js"><link rel="prefetch" href="/assets/js/35.8670a9ec.js"><link rel="prefetch" href="/assets/js/36.1c598a91.js"><link rel="prefetch" href="/assets/js/37.c6e170fd.js"><link rel="prefetch" href="/assets/js/38.b849b9f3.js"><link rel="prefetch" href="/assets/js/39.157d6396.js"><link rel="prefetch" href="/assets/js/40.94a88d06.js"><link rel="prefetch" href="/assets/js/41.ad2938e3.js"><link rel="prefetch" href="/assets/js/42.9c02597f.js"><link rel="prefetch" href="/assets/js/43.f5d97bff.js"><link rel="prefetch" href="/assets/js/44.866fc09a.js"><link rel="prefetch" href="/assets/js/45.95b338c1.js"><link rel="prefetch" href="/assets/js/46.4f2b6d71.js"><link rel="prefetch" href="/assets/js/47.2457e1a5.js"><link rel="prefetch" href="/assets/js/48.63eb1b00.js"><link rel="prefetch" href="/assets/js/49.d26d6942.js"><link rel="prefetch" href="/assets/js/5.203dfd51.js"><link rel="prefetch" href="/assets/js/50.287aef99.js"><link rel="prefetch" href="/assets/js/51.3ac2a52a.js"><link rel="prefetch" href="/assets/js/52.da0a650e.js"><link rel="prefetch" href="/assets/js/53.9f062a61.js"><link rel="prefetch" href="/assets/js/54.aeeca047.js"><link rel="prefetch" href="/assets/js/55.07e19b99.js"><link rel="prefetch" href="/assets/js/56.b1ff2e94.js"><link rel="prefetch" href="/assets/js/57.e8193662.js"><link rel="prefetch" href="/assets/js/58.b5f2c4fc.js"><link rel="prefetch" href="/assets/js/59.3ceae42b.js"><link rel="prefetch" href="/assets/js/6.2b87caaa.js"><link rel="prefetch" href="/assets/js/60.90fae839.js"><link rel="prefetch" href="/assets/js/61.8e5d8971.js"><link rel="prefetch" href="/assets/js/63.6f1b7525.js"><link rel="prefetch" href="/assets/js/64.d209c95c.js"><link rel="prefetch" href="/assets/js/65.70523632.js"><link rel="prefetch" href="/assets/js/66.f90bb25d.js"><link rel="prefetch" href="/assets/js/67.091973a4.js"><link rel="prefetch" href="/assets/js/68.34103dc6.js"><link rel="prefetch" href="/assets/js/69.e773d88c.js"><link rel="prefetch" href="/assets/js/7.838ec26c.js"><link rel="prefetch" href="/assets/js/70.950adf9d.js"><link rel="prefetch" href="/assets/js/71.44f9739e.js"><link rel="prefetch" href="/assets/js/72.0f1b362d.js"><link rel="prefetch" href="/assets/js/73.547780a1.js"><link rel="prefetch" href="/assets/js/74.2ae20142.js"><link rel="prefetch" href="/assets/js/75.563c5a8b.js"><link rel="prefetch" href="/assets/js/76.ecbf06c0.js"><link rel="prefetch" href="/assets/js/8.d26d194d.js"><link rel="prefetch" href="/assets/js/9.b82b5c16.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.45c7b1bd.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.fc267309.js">
    <link rel="stylesheet" href="/assets/css/0.styles.097f5d83.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-b812d5fc><header class="navbar" data-v-b812d5fc><div class="wrap"><div class="wrap-border"><a href="/" class="home-link router-link-active"><svg role="img" alt="Lightning Dev Kit Documentation" class="logo"><use href="/img/logo.svg#small" class="small"></use> <use href="/img/logo.svg#large" class="large"></use></svg></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/introduction/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/case-studies/" class="nav-link">
  Case Studies
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://discord.gg/5AcknnMfBw" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/lightningdevkit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/lightningdevkit/lightningdevkit.org" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <button type="button" class="theme-switch"><svg viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg"><g class="theme-switch-dark"><path d="M15 20.4219C12.5187 20.4219 10.5 18.4032 10.5 15.9219C10.5 13.4406 12.5187 11.4219 15 11.4219C17.4813 11.4219 19.5 13.4406 19.5 15.9219C19.5 18.4032 17.4813 20.4219 15 20.4219Z" fill="currentColor"></path> <path d="M19.4541 20.3769L21.3644 22.2862M15 24.9219V22.2219V24.9219ZM15 9.62187V6.92188V9.62187ZM6 15.9219H8.7H6ZM21.3 15.9219H24H21.3ZM8.6361 22.2862L10.5454 20.3769L8.6361 22.2862ZM19.4541 11.4678L21.3644 9.55797L19.4541 11.4678ZM8.6361 9.55797L10.5454 11.4678L8.6361 9.55797Z" stroke="currentColor" stroke-width="1" stroke-linecap="round"></path></g> <g fill="currentColor" class="theme-switch-light"><path d="M10.1539 8.75585C10.018 8.75585 9.88774 8.70189 9.79168 8.60583C9.69563 8.50977 9.64166 8.37949 9.64166 8.24365V6.19482C9.64166 6.05898 9.69563 5.9287 9.79168 5.83264C9.88774 5.73658 10.018 5.68262 10.1539 5.68262C10.2897 5.68262 10.42 5.73658 10.5161 5.83264C10.6121 5.9287 10.6661 6.05898 10.6661 6.19482V8.24365C10.6661 8.37949 10.6121 8.50977 10.5161 8.60583C10.42 8.70189 10.2897 8.75585 10.1539 8.75585Z"></path> <path d="M11.1783 7.73144H9.12945C8.9936 7.73144 8.86332 7.67748 8.76726 7.58142C8.6712 7.48536 8.61724 7.35508 8.61724 7.21924C8.61724 7.08339 8.6712 6.95311 8.76726 6.85705C8.86332 6.761 8.9936 6.70703 9.12945 6.70703H11.1783C11.3141 6.70703 11.4444 6.761 11.5405 6.85705C11.6365 6.95311 11.6905 7.08339 11.6905 7.21924C11.6905 7.35508 11.6365 7.48536 11.5405 7.58142C11.4444 7.67748 11.3141 7.73144 11.1783 7.73144ZM6.05621 13.8779C5.92037 13.8779 5.79009 13.8239 5.69403 13.7279C5.59797 13.6318 5.54401 13.5015 5.54401 13.3657V12.3413C5.54401 12.2054 5.59797 12.0752 5.69403 11.9791C5.79009 11.8831 5.92037 11.8291 6.05621 11.8291C6.19206 11.8291 6.32234 11.8831 6.4184 11.9791C6.51445 12.0752 6.56842 12.2054 6.56842 12.3413V13.3657C6.56842 13.5015 6.51445 13.6318 6.4184 13.7279C6.32234 13.8239 6.19206 13.8779 6.05621 13.8779Z"></path> <path d="M6.56842 13.366H5.544C5.40816 13.366 5.27788 13.312 5.18182 13.216C5.08576 13.1199 5.0318 12.9896 5.0318 12.8538C5.0318 12.7179 5.08576 12.5877 5.18182 12.4916C5.27788 12.3955 5.40816 12.3416 5.544 12.3416H6.56842C6.70426 12.3416 6.83454 12.3955 6.9306 12.4916C7.02666 12.5877 7.08062 12.7179 7.08062 12.8538C7.08062 12.9896 7.02666 13.1199 6.9306 13.216C6.83454 13.312 6.70426 13.366 6.56842 13.366ZM16.8125 23.6101C12.8583 23.6101 9.64165 20.3934 9.64165 16.4392C9.64165 12.8983 12.2851 9.85021 15.7907 9.34876L16.4658 9.25195L16.37 9.92755C16.326 10.218 16.3027 10.5112 16.3003 10.805C16.3003 14.1942 19.0575 16.9514 22.4468 16.9514C22.708 16.9514 22.9872 16.9294 23.3247 16.8813L23.9998 16.7855L23.9035 17.4606C23.401 20.9666 20.3524 23.6101 16.8125 23.6101Z"></path></g></svg></button></div> <div class="sidebar-button"><svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="icon"><g fill="currentColor" class="hamburger"><path d="M33.75 11.6699H6.25C5.55964 11.6699 5 12.2296 5 12.9199C5 13.6103 5.55964 14.1699 6.25 14.1699H33.75C34.4404 14.1699 35 13.6103 35 12.9199C35 12.2296 34.4404 11.6699 33.75 11.6699Z"></path> <path d="M28.75 18.752H6.25C5.55964 18.752 5 19.3116 5 20.002C5 20.6923 5.55964 21.252 6.25 21.252H28.75C29.4404 21.252 30 20.6923 30 20.002C30 19.3116 29.4404 18.752 28.75 18.752Z"></path> <path d="M33.75 25.8301H6.25C5.55964 25.8301 5 26.3897 5 27.0801C5 27.7704 5.55964 28.3301 6.25 28.3301H33.75C34.4404 28.3301 35 27.7704 35 27.0801C35 26.3897 34.4404 25.8301 33.75 25.8301Z"></path></g> <g stroke="currentColor" class="close"><path d="M10 10L30 30" stroke-width="2" stroke-linecap="round"></path> <path d="M30 10L10 30" stroke-width="2" stroke-linecap="round"></path></g></svg></div></div></div></header> <div class="wrap" data-v-b812d5fc><div class="wrap-border" data-v-b812d5fc><div class="sidebar-mask" data-v-b812d5fc></div> <aside class="sidebar" data-v-b812d5fc><nav class="nav-links"><div class="nav-item"><a href="/introduction/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/case-studies/" class="nav-link">
  Case Studies
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://discord.gg/5AcknnMfBw" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/lightningdevkit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/lightningdevkit/lightningdevkit.org" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Documentation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/introduction/" class="sidebar-heading clickable open"><span>Introduction</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction/use-cases/" class="sidebar-link">Use Cases</a></li><li><a href="/introduction/architecture/" class="sidebar-link">Architecture</a></li><li><a href="/introduction/peer-management/" class="sidebar-link">Peer Management</a></li><li><a href="/introduction/persistent_storage/" class="sidebar-link">Persistent Storage</a></li><li><a href="/introduction/blockchain_data/" class="sidebar-link">Blockchain Data</a></li><li><a href="/introduction/wallet_management/" class="sidebar-link">Wallet Management</a></li><li><a href="/introduction/networking/" class="sidebar-link">Networking</a></li><li><a href="/introduction/private_key_management/" class="sidebar-link">Private Key Management</a></li><li><a href="/introduction/transactions/" class="sidebar-link">Transactions</a></li><li><a href="/introduction/random_number_generation/" class="sidebar-link">Random Number Generation</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Building a node with LDK</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/running-a-sample-ldk-node/" class="sidebar-link">Running a sample LDK node</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Blockchain Data</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/key_management/" class="sidebar-link">Key Management</a></li><li><a href="/fee_estimation/" aria-current="page" class="active sidebar-link">Fee Estimation</a></li><li><a href="/probing/" class="sidebar-link">Probing and Path Finding</a></li><li><a href="/examples/" class="sidebar-link">Examples</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>API Reference</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Rust</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="https://docs.rs/lightning/*/lightning/" target="_blank" rel="noopener noreferrer" class="sidebar-link">lightning<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://docs.rs/lightning-background-processor/*/lightning_background_processor/" target="_blank" rel="noopener noreferrer" class="sidebar-link">lightning-background-processor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://docs.rs/lightning-block-sync/*/lightning_block_sync/" target="_blank" rel="noopener noreferrer" class="sidebar-link">lightning-block-sync<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://docs.rs/lightning-invoice/*/lightning_invoice/" target="_blank" rel="noopener noreferrer" class="sidebar-link">lightning-invoice<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://docs.rs/lightning-net-tokio/*/lightning_net_tokio/" target="_blank" rel="noopener noreferrer" class="sidebar-link">lightning-net-tokio<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://docs.rs/lightning-persister/*/lightning_persister/" target="_blank" rel="noopener noreferrer" class="sidebar-link">lightning-persister<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://docs.rs/lightning-rapid-gossip-sync/*/lightning_rapid_gossip_sync/" target="_blank" rel="noopener noreferrer" class="sidebar-link">lightning-rapid-gossip-sync<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://docs.rs/lightning-transaction-sync/*/lightning_transaction_sync/" target="_blank" rel="noopener noreferrer" class="sidebar-link">lightning-transaction-sync<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://docs.rs/lightning-custom-message/*/lightning_custom_message/" target="_blank" rel="noopener noreferrer" class="sidebar-link">lightning-custom-message<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></section></li><li><a href="https://github.com/arik-so/SwiftLightning/tree/master/Documentation" target="_blank" rel="noopener noreferrer" class="sidebar-link">Swift<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></section></li></ul> </aside> <!----> <main class="page"> <div class="theme-default-content content__default"><h1 id="fee-estimation"><a href="#fee-estimation" class="header-anchor">#</a> Fee Estimation</h1> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>LDK provides a <code>FeeEstimator</code> trait which, once implemented, assists in variety of on-chain and off-chain tasks. It's important to note that the <code>FeeEstimator</code> only describes the architectural requirements that must be satisfied to successfully incorporate LDK into your project. It does not, itself, provide the logic or implementation to calculate a feerate.</p> <p>In LDK, feerates are separated into eight categories. Each category is known as a <code>ConfirmationTarget</code>. We'll provide a brief review of these shortly, but, for now, it's sufficient to understand that these categories represent various scenarios in which we need feerate information. For example, one <code>ConfirmationTarget</code> is <code>ConfirmationTarget::MinAllowedAnchorChannelRemoteFee</code>, which describes the lowest feerate we will allow our channel counterparty to have in an anchor channel.</p> <p>Feerates and their functionality within LDK can be conceptually separated into on-chain (Bitcoin) and off-chain (Lightning Network) tasks.</p> <h4 id="on-chain"><a href="#on-chain" class="header-anchor">#</a> On-Chain</h4> <p>Lightning's security model is dependent on the ability to confirm a claim transaction under a variety of circumstances, such as before a timelock expires. To ensure that LDK is able to confirm claim transactions in a timely manner or bump the fee on an existing transaction, LDK utilizes the <code>FeeEstimator</code> to fetch feerates for high priority transactions. For example, the <code>ConfirmationTarget::UrgentOnChainSweep</code> specifies the feerate used when we have funds available on-chain that must be spent before a certain expiry time, beyond which our counterparty could potentially steal them. Additionally, the <code>ConfirmationTarget::OutputSpendingFee</code> is used by the <code>OutputSweeper</code> utility to ensure that, after channel closure, all funds are eventually swept to an onchain address controlled by the user.</p> <h4 id="off-chain"><a href="#off-chain" class="header-anchor">#</a> Off-Chain</h4> <p>From an off-chain perspective, the <code>FeeEstimator</code> provides vital information that is used when opening, closing, and operating channels with peers on the Lightning Network. For example, when opening an inbound channel or updating an existing channel with a counterparty, LDK will compare the counterparty's proposed feerate with the minimum feerate that is allowed for that type of channel (e.g., anchor or non-anchor channel). If the proposed fee is too low, LDK may return an error and suggest closing the channel. During these operations, LDK will reference the <code>ConfirmationTarget::MinAllowedAnchorChannelRemoteFee</code> and the <code>ConfirmationTarget::MinAllowedNonAnchorChannelRemoteFee</code>. Therefore, it's recommended to ensure that the minimum allowable fees are not set too high, thus increasing the risk that a peer's proposed feerate is too low, potentially resulting in a force closure.</p> <p>On the other hand, when determining if a counterparty's proposed feerate is too high, LDK will reference the <code>ConfirmationTarget::MaximumFeeEstimate</code>. This <code>ConfirmationTarget</code> is particularly important, as it helps a node distinguish between reasonably high fees (e.g., during high-fee environments) and purposefully high fees (e.g., griefing attacks). See the <a href="#best-practices"><strong>Best Practices</strong></a> section in this documentation for more helpful tips when implementing LDK's <code>FeeEstimator</code>.</p> <p>Another instance where LDK utilizes the <code>FeeEstimator</code> is during a cooperative channel closure. In this case, LDK references the <code>ConfirmationTarget::ChannelCloseMinimum</code> and <code>ConfirmationTarget::NonAnchorChannelFee</code> to estimate a feerate range, which is then proposed to the counterparty for closing the channel.</p> <h2 id="the-feeestimator"><a href="#the-feeestimator" class="header-anchor">#</a> The <code>FeeEstimator</code></h2> <p>LDK's <code>FeeEstimator</code> trait (seen below) is at the heart of fee estimation within LDK.</p> <p>You'll notice that it has <strong>one required method</strong>, <code>get_est_sat_per_1000_weight</code>. This method is referenced throughout LDK to fetch feerate information when performing actions such as opening lightning channels, closing lightning channels, or sweeping funds on-chain. You'll also notice that the <code>get_est_sat_per_1000_weight</code> has <strong>one required input</strong>: a <code>ConfirmationTarget</code>. The next section will describe the <code>ConfirmationTarget</code> in more detail. For now, it's important to note that the implementation of <code>get_est_sat_per_1000_weight</code> must be completed by the developer. Once completed, this method should return the estimated fee (in sats/KW) for the given <code>ConfirmationTarget</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">FeeEstimator</span> <span class="token punctuation">{</span>
	<span class="token comment">/// Gets estimated satoshis of fee required per 1000 Weight-Units.</span>
	<span class="token comment">///</span>
	<span class="token comment">/// LDK will wrap this method and ensure that the value returned is no smaller than 253</span>
	<span class="token comment">/// (ie 1 satoshi-per-byte rounded up to ensure later round-downs don't put us below 1 satoshi-per-byte).</span>
	<span class="token comment">///</span>
	<span class="token comment">/// The following unit conversions can be used to convert to sats/KW:</span>
	<span class="token comment">///  * satoshis-per-byte * 250</span>
	<span class="token comment">///  * satoshis-per-kbyte / 4</span>
	<span class="token keyword">fn</span> <span class="token function-definition function">get_est_sat_per_1000_weight</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> confirmation_target<span class="token punctuation">:</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="the-confirmationtarget"><a href="#the-confirmationtarget" class="header-anchor">#</a> The <code>ConfirmationTarget</code></h2> <p>The <code>ConfirmationTarget</code> enables the user to define the feerate that LDK will use for a variety of on-chain and off-chain tasks. For a detailed description of each <code>ConfirmationTarget</code>, please visit <a href="https://docs.rs/lightning/latest/lightning/chain/chaininterface/enum.ConfirmationTarget.html#" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="best-practices"><a href="#best-practices" class="header-anchor">#</a> Best Practices</h2> <h3 id="estimating-fees"><a href="#estimating-fees" class="header-anchor">#</a> Estimating Fees</h3> <p>The end goal is to implement the function <code>get_est_sat_per_1000_weight</code> such that it will return a feerate in sats/KW (satoshis-per-byte * 250) for each of the <code>ConfirmationTarget</code> options. Therefore, the question is: <strong>how should we determine the right feerate to provide when <code>get_est_sat_per_1000_weight</code> is called?</strong></p> <p>A popular approach is to fetch feerate information from a third-party such as mempool.space by sending a GET request to their <a href="https://mempool.space/docs/api/rest#get-recommended-fees" target="_blank" rel="noopener noreferrer">get-recommended-fees<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> endpoint. Another option is to connect to your own local mempool. Depending on which approach you take, you may get fee estimates that are already separated into categories (e.g., high, medium, low), or you may have to request fee estimates with a specific confirmation target in mind (e.g., fetching fees for a transaction that you want to be mined within the next 6 blocks). Regardless of your approach, you will ultimately have to map the feerate estimate back to each <code>ConfirmationTarget</code>. To help make this easier, a table has been provided below with recommendations for how you could map each <code>ConfirmationTarget</code> to both a mempool.space fee category and the estimated number of blocks each <code>ConfirmationTarget</code> may represent. Please keep in mind, these are only recommendations. In practice, confirmation targets are influenced by each developer's fee strategy and risk-tolerance and may change accordingly.</p> <table><thead><tr><th style="text-align:left;">ConfirmationTarget</th> <th style="text-align:center;">mempool.space Category</th> <th style="text-align:center;">Number of Blocks</th></tr></thead> <tbody><tr><td style="text-align:left;">MaximumFeeEstimate</td> <td style="text-align:center;">fastestFee</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:left;">UrgentOnChainSweep</td> <td style="text-align:center;">hourFee</td> <td style="text-align:center;">6</td></tr> <tr><td style="text-align:left;">MinAllowedAnchorChannelRemoteFee</td> <td style="text-align:center;">minimumFee</td> <td style="text-align:center;">1008</td></tr> <tr><td style="text-align:left;">MinAllowedNonAnchorChannelRemoteFee</td> <td style="text-align:center;">economyFee</td> <td style="text-align:center;">144</td></tr> <tr><td style="text-align:left;">AnchorChannelFee</td> <td style="text-align:center;">economyFee</td> <td style="text-align:center;">144</td></tr> <tr><td style="text-align:left;">NonAnchorChannelFee</td> <td style="text-align:center;">economyFee</td> <td style="text-align:center;">12</td></tr> <tr><td style="text-align:left;">ChannelCloseMinimum</td> <td style="text-align:center;">economyFee</td> <td style="text-align:center;">144</td></tr> <tr><td style="text-align:left;">OutputSpendingFee</td> <td style="text-align:center;">economyFee</td> <td style="text-align:center;">12</td></tr></tbody></table> <p><strong>NOTE</strong>: Setting <code>ConfirmationTarget::MinAllowedAnchorChannelRemoteFee</code> or <code>ConfirmationTarget::MinAllowedNonAnchorChannelRemoteFee</code> <strong>too high</strong>, will increase the risk that a peer's proposed feerate is, comparatively, too low, potentially resulting in a force closure. Similarly, setting <code>ConfirmationTarget::AnchorChannelFee</code> or <code>ConfirmationTarget::NonAnchorChannelFee</code> <strong>too low</strong>, will increase the risk that your node's proposed feerate is, comparatively, too low, potentially resulting in a force closure.</p> <p>Relatedly, recall that <code>ConfirmationTarget::MaximumFeeEstimate</code> helps to avoid force-closures by setting the upper bound for an acceptable proposed feerate from a peer. Therefore, this should be the most aggressive (i.e., highest) feerate estimate available.</p> <h3 id="general-architecture-approaches"><a href="#general-architecture-approaches" class="header-anchor">#</a> General Architecture Approaches</h3> <p>Now that we've seen a few approaches towards retrieving feerate estimates such that we can return a recommended fee for each <code>ConfirmationTarget</code>, let's review some best practices for <code>FeeEstimator</code> architecture.</p> <p>First, let's circle back to <code>get_est_sat_per_1000_weight</code> function. While there are many ways to develop logic to determine which feerate to provide for a specific <code>ConfirmationTarget</code>, a popular approach is to fetch this information using a tiered methodology. This will help ensure that, if there is a failure in retrieving fees from one method, another method can serve as a backup and ensure that normal node operations are not impacted. For example, one approach to populating fees is the following:</p> <ul><li>If mempool.space successfully returns fee estimates, use those.</li> <li>Otherwise, fetch fee estimates from your local mempool</li> <li>If both of the above fail, use hard-coded fall-back fees, mapped to each <code>ConfirmationTarget</code>.</li></ul> <p>Please note, if you're using a third-party fee estimator, there are a few things you should keep in mind:</p> <ul><li>Third parties often rate-limit users such that they can only access a limited number of fee estimates within a given timeframe. If you require a certain service level agreement (SLA), it's recommended to run your own Bitcoin node or explore paid services with SLA guarantees, such as <a href="https://mempool.space/enterprise" target="_blank" rel="noopener noreferrer">mempool.space enterprise accounts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li>Leveraging third-party providers may leave you more exposed to a griefing attack, where your fee estimator purposely overestimates the feerate, causing you to accept more dust HTLCs than you would otherwise.</li> <li>Third-party fee estimates may affect the propagation of your pre-signed transactions at any time and, therefore, endanger the safety of channel funds.</li></ul> <p>Running your own Bitcoin node can relieve some of these concerns, but it may require additional technical expertise and maintenance to operate properly. These trade-offs should be considered carefully when deciding how your application will retrieve fee estimates.</p> <p>A savvy reader may have noticed that the above architecture is not very performant. LDK may generate a substantial number of fee-estimation calls in some cases. So, if we have to call an API every time we want a fee estimate, we'll add a significant amount of additional load to our application, and we may substantially slow HTLC handling. To ensure your application remains performant, you should pre-calculate and cache the fee estimates so that they can simply be retrieved when needed. Additionally, it's recommended to refresh fee estimates every 5-10 minutes so that your application has access to fresh freerates.</p> <h3 id="feerate-api-options"><a href="#feerate-api-options" class="header-anchor">#</a> Feerate API Options</h3> <p>While mempool.space serves as the primary example in this documentation, it is not the only third-party option for retrieving feerate estimates. A few more options are listed below. For completeness, mempool.space is also included below.</p> <table><thead><tr><th style="text-align:left;">Third Party</th> <th style="text-align:center;">API Documentation</th> <th style="text-align:center;">Response Type</th></tr></thead> <tbody><tr><td style="text-align:left;">Mempool.space</td> <td style="text-align:center;"><a href="https://mempool.space/docs/api/rest#get-recommended-fees" target="_blank" rel="noopener noreferrer">API Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:center;">Categories (e.g., fastestFee, halfHourFee, hourFee, economyFee, minimumFee)</td></tr> <tr><td style="text-align:left;">Blockstream</td> <td style="text-align:center;"><a href="https://github.com/Blockstream/esplora/blob/master/API.md#get-fee-estimates" target="_blank" rel="noopener noreferrer">API Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:center;">Confirmation Targets (in blocks)</td></tr> <tr><td style="text-align:left;">bitcoiner.live</td> <td style="text-align:center;"><a href="https://bitcoiner.live/doc/api" target="_blank" rel="noopener noreferrer">API Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:center;">Confirmation Targets (in minutes)</td></tr> <tr><td style="text-align:left;">BitGo</td> <td style="text-align:center;"><a href="https://developers.bitgo.com/api/v2.tx.getfeeestimate" target="_blank" rel="noopener noreferrer">API Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:center;">Confirmation Targets (in blocks)</td></tr> <tr><td style="text-align:left;">blockchain.info</td> <td style="text-align:center;">Missing Documentation. API is here: https://api.blockchain.info/mempool/fees</td> <td style="text-align:center;">Categories (e.g., regular, priority)</td></tr></tbody></table> <h2 id="coding-example"><a href="#coding-example" class="header-anchor">#</a> Coding Example</h2> <p>Now that we've reviewed the basic architecture, let's code up an example to demonstrate how you can implement the <code>FeeEstimator</code> in your project.</p> <h3 id="optional-set-up"><a href="#optional-set-up" class="header-anchor">#</a> Optional: Set Up</h3> <p>If you'd like to follow along with this demo, you can set up a new Rust project using <code>cargo new</code> followed by the name of the project. We'll call this <code>ldk-fee-estimator</code>.</p> <div class="language- extra-class"><pre class="language-text"><code>$ cargo new ldk-fee-estimator
$ cd ldk-fee-estimator
</code></pre></div><p>Once you've created the directory, open the <code>Cargo.toml</code> file, which Cargo uses to manage version and package dependencies, and copy/paste the following code into that file.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span>package<span class="token punctuation">]</span>
name <span class="token operator">=</span> <span class="token string">&quot;ldk-fee-estimator&quot;</span>
version <span class="token operator">=</span> <span class="token string">&quot;0.1.0&quot;</span>
edition <span class="token operator">=</span> <span class="token string">&quot;2024&quot;</span>

<span class="token punctuation">[</span>dependencies<span class="token punctuation">]</span>
lightning <span class="token operator">=</span> <span class="token punctuation">{</span> version <span class="token operator">=</span> <span class="token string">&quot;0.0.124&quot;</span><span class="token punctuation">,</span> features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;max_level_trace&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
lightning<span class="token operator">-</span>block<span class="token operator">-</span>sync <span class="token operator">=</span> <span class="token punctuation">{</span> version <span class="token operator">=</span> <span class="token string">&quot;0.0.124&quot;</span><span class="token punctuation">,</span> features <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;rpc-client&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
lightning<span class="token operator">-</span>invoice <span class="token operator">=</span> <span class="token punctuation">{</span> version <span class="token operator">=</span> <span class="token string">&quot;0.31.0&quot;</span> <span class="token punctuation">}</span>
lightning<span class="token operator">-</span>net<span class="token operator">-</span>tokio <span class="token operator">=</span> <span class="token punctuation">{</span> version <span class="token operator">=</span> <span class="token string">&quot;0.0.124&quot;</span> <span class="token punctuation">}</span>
lightning<span class="token operator">-</span>persister <span class="token operator">=</span> <span class="token punctuation">{</span> version <span class="token operator">=</span> <span class="token string">&quot;0.0.124&quot;</span> <span class="token punctuation">}</span>
lightning<span class="token operator">-</span>background<span class="token operator">-</span>processor <span class="token operator">=</span> <span class="token punctuation">{</span> version <span class="token operator">=</span> <span class="token string">&quot;0.0.124&quot;</span> <span class="token punctuation">}</span>
lightning<span class="token operator">-</span>rapid<span class="token operator">-</span>gossip<span class="token operator">-</span>sync <span class="token operator">=</span> <span class="token punctuation">{</span> version <span class="token operator">=</span> <span class="token string">&quot;0.0.124&quot;</span> <span class="token punctuation">}</span>
reqwest <span class="token operator">=</span> <span class="token punctuation">{</span> version <span class="token operator">=</span> <span class="token string">&quot;0.11&quot;</span><span class="token punctuation">,</span> features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blocking&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
serde <span class="token operator">=</span> <span class="token punctuation">{</span> version <span class="token operator">=</span> <span class="token string">&quot;1.0&quot;</span><span class="token punctuation">,</span> features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;derive&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
tokio <span class="token operator">=</span> <span class="token punctuation">{</span> version <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;full&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>  # <span class="token class-name">Async</span> runtime<span class="token punctuation">,</span> required <span class="token keyword">for</span> reqwest
</code></pre></div><p>Finally, go to main.rs and place the following code at the top of the file.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">lightning<span class="token punctuation">::</span>chain<span class="token punctuation">::</span>chaininterface<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">,</span> <span class="token class-name">FeeEstimator</span><span class="token punctuation">,</span> <span class="token constant">FEERATE_FLOOR_SATS_PER_KW</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token class-name">Deserialize</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>cmp<span class="token punctuation">;</span>
</code></pre></div><h3 id="defining-myappfeeestimator"><a href="#defining-myappfeeestimator" class="header-anchor">#</a> Defining <code>MyAppFeeEstimator</code></h3> <p>First, we'll start by defining a structure, called <code>MyAppFeeEstimator</code>, which will be used to store feerates associated with each <code>ConfirmationTarget</code>. The field <code>fee_rate_cache</code> will contain a <strong>HashMap</strong> where the keys are of type <code>ConfirmationTarget</code> and the values are the feerates (type <code>u32</code>) in sats/KW. We'll store them in sats/KW because, as we saw earlier, the <code>get_est_sat_per_1000_weight</code> method in LDK's <code>FeeEstimator</code> <a href="https://docs.rs/lightning/latest/lightning/chain/chaininterface/trait.FeeEstimator.html#required-methods" target="_blank" rel="noopener noreferrer">expects fees to be provided in 1000 Weight-Units<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, so we'll store them in sats/KW.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MyAppFeeEstimator</span> <span class="token punctuation">{</span>
    fee_rate_cache<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="retrieving-fees-from-mempoolspace-and-implementing-myappfeeestimator"><a href="#retrieving-fees-from-mempoolspace-and-implementing-myappfeeestimator" class="header-anchor">#</a> Retrieving Fees From mempool.space And Implementing <code>MyAppFeeEstimator</code></h3> <p>Now that we have our basic structure for <code>MyAppFeeEstimator</code>, let's write some code to fetch the feerates themselves. For this example, we'll fetch feerates from mempool.space. To do this, we'll start by defining a <code>MempoolFeeRate</code> structure. Since mempool's <a href="https://mempool.space/docs/api/rest#get-recommended-fees" target="_blank" rel="noopener noreferrer">recommmended fees API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> returns five different feerates (fastestFee, halfHourFee, hourFee, economyFee, minimumFee), we'll create a field for each rate. Also, since this structure will have to deserialize &quot;camalCase&quot; JSON data fetched from the API, we'll have to add those attributes to our structure.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Deserialize, Debug)]</span>
<span class="token attribute attr-name">#[serde(rename_all = <span class="token string">&quot;camelCase&quot;</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MempoolFeeRate</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> fastest_fee<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> half_hour_fee<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> hour_fee<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> economy_fee<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> minimum_fee<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now that our <code>MempoolFeeRate</code> structure is defined, we can begin building out the <code>MyAppFeeEstimator</code>. We'll start by implementing the <code>MyAppFeeEstimator</code> and adding our first function to this structure: <code>fetch_fee_from_mempool</code>. This function will fetch the feerates from mempool's API, process the response according to our <code>MempoolFeeRate</code> structure, and return the result. Since we'll be making an HTTP request using Rust's <code>reqwest</code> crate, we'll tag this function as asynchronous (<code>async</code>).</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span> <span class="token class-name">MyAppFeeEstimator</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">fetch_fee_from_mempool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">MempoolFeeRate</span><span class="token punctuation">,</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;https://mempool.space/api/v1/fees/recommended&quot;</span><span class="token punctuation">;</span>
        <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Client</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span>
                    <span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">MempoolFeeRate</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token keyword">await</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="retrieving-default-fees"><a href="#retrieving-default-fees" class="header-anchor">#</a> Retrieving Default Fees</h3> <p>Great, we now have a function that will return mempool.space feerates! However, as discussed earlier, we don't want to rely on only one source for our fee estimates. In a real production environment, we'd likely have a local mempool that we're sourcing feerates from and, perhaps, one or more third-party services. For this demo, we'll hard-code fallback feerates and return those if we're unable to retrieve a feerate from mepool.space.</p> <p>Another reason we need default fee estimates is so that we can create instances of <code>MyAppFeeEstimator</code> without waiting for the feerates to be fetched from mempool.space (or any async operation). Therefore, we'll write a function that will return a hard-coded feerate for a given <code>ConfirmationTarget</code>. For simplicity, feerates below are presented as sats/vByte * 250 so that they are easier to read but, ultimately, they are stored within the cache as sats/KW. Note that this function is also a method within <code>MyAppFeeEstimator</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">default_fee_from_conf_target</span><span class="token punctuation">(</span>confirmation_target<span class="token punctuation">:</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> confirmation_target <span class="token punctuation">{</span>
        <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MaximumFeeEstimate</span> <span class="token operator">=&gt;</span> <span class="token number">75</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
        <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MinAllowedAnchorChannelRemoteFee</span> <span class="token operator">=&gt;</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
        <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MinAllowedNonAnchorChannelRemoteFee</span> <span class="token operator">=&gt;</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
        <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">ChannelCloseMinimum</span> <span class="token operator">=&gt;</span> <span class="token number">20</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
        <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">AnchorChannelFee</span> <span class="token operator">=&gt;</span> <span class="token number">20</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
        <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">NonAnchorChannelFee</span> <span class="token operator">=&gt;</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
        <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">UrgentOnChainSweep</span> <span class="token operator">=&gt;</span> <span class="token number">50</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
        <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">OutputSpendingFee</span> <span class="token operator">=&gt;</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="creating-a-myappfeeestimator-instance"><a href="#creating-a-myappfeeestimator-instance" class="header-anchor">#</a> Creating a <code>MyAppFeeEstimator</code> Instance</h3> <p>Now that we've built the functionality to fetch feerates, we can start linking everything together. Let's begin by writing a <code>new</code> method, which we'll call each time we initialize a fee estimator. The <code>new</code> method will initialize an empty HashMap called <code>fee_rate_cache</code>, which we defined in our <code>MyAppFeeEstimator</code> structure earlier. It will then proceed to populate each of the required <code>ConfirmationTarget</code> fields with its respective feerate. Remember, to ensure our application is performant and does not have to wait for network operations when initializing a fee estimator, we will originally load the feerates with our default values.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> fee_rate_cache <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">use</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> target <span class="token keyword">in</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
            <span class="token class-name">MinAllowedAnchorChannelRemoteFee</span><span class="token punctuation">,</span>
            <span class="token class-name">MinAllowedNonAnchorChannelRemoteFee</span><span class="token punctuation">,</span>
            <span class="token class-name">ChannelCloseMinimum</span><span class="token punctuation">,</span>
            <span class="token class-name">AnchorChannelFee</span><span class="token punctuation">,</span>
            <span class="token class-name">NonAnchorChannelFee</span><span class="token punctuation">,</span>
            <span class="token class-name">UrgentOnChainSweep</span><span class="token punctuation">,</span>
            <span class="token class-name">OutputSpendingFee</span><span class="token punctuation">,</span>
            <span class="token class-name">MaximumFeeEstimate</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> default_fee <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">default_fee_from_conf_target</span><span class="token punctuation">(</span><span class="token operator">*</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token operator">*</span>target<span class="token punctuation">,</span> default_fee<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">MyAppFeeEstimator</span> <span class="token punctuation">{</span>
        fee_rate_cache
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="updating-fees"><a href="#updating-fees" class="header-anchor">#</a> Updating Fees</h3> <p>Great, we now have a <code>new</code> function that will populate each instance of our fee estimator with the default rates.</p> <p>However, we're not done yet! We already wrote code to fetch feerates from mempool.space, but we haven't inserted them into our cache. Let's do that now. We'll accomplish this by writing an <code>update_fees</code> method. A keen eye will likely notice that the feerates are multiplied by 250 before being added to the cache. This is because mempool.space returns feerates in sats/vByte, but we need them in sats/KW, so we can multiply them by 250 to convert them to sats/KW and then store them within our cache. Make sure both <code>update_fees</code> and <code>new</code> are added as methods within <code>MyAppFeeEstimator</code>!</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">update_fees</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> fee_rates <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">fetch_fee_from_mempool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> fee_rates <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>rates<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MaximumFeeEstimate</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>fastest_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">UrgentOnChainSweep</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>fastest_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">OutputSpendingFee</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>fastest_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">NonAnchorChannelFee</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>economy_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">AnchorChannelFee</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>minimum_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">ChannelCloseMinimum</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>minimum_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MinAllowedNonAnchorChannelRemoteFee</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>minimum_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MinAllowedAnchorChannelRemoteFee</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>minimum_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// If the API call fails, the fallback fees are already in cache</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="retrieving-fees-based-on-a-confirmationtarget"><a href="#retrieving-fees-based-on-a-confirmationtarget" class="header-anchor">#</a> Retrieving Fees Based On A <code>ConfirmationTarget</code></h3> <p>We're making solid progress! Remember, the end goal here is to build out a robust fee estimation logic that we can link back to the <code>get_est_sat_per_1000_weight</code> function in LDK's <code>FeeEstimator</code>. Since <code>get_est_sat_per_1000_weight</code> takes one input, a <code>ConfirmationTarget</code>, we'll have to write a function that returns the feerate for a specific <code>ConfirmationTarget</code>. Now that we have mempool.space fees cached within the <code>MyAppFeeEstimator</code>, we can do just that. Also, to ensure that fee estimates are not too low such that they run the risk of never being mined, we'll check that the fee we return is at least 253 sats/KW. This fee is also enforced within LDK's implementation of the <code>FeeEstimator</code> and is defined <a href="https://docs.rs/lightning/latest/lightning/chain/chaininterface/constant.FEERATE_FLOOR_SATS_PER_KW.html" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. We'll import this constant and use it in our function as well.</p> <p>Below is a function that takes a <code>ConfirmationTarget</code> as an input, fetches the feerate for that <code>ConfirmationTarget</code> from our cache, and returns the result. If the fetched feerate is lower than the minimum feerate defined in LDK, <code>FEERATE_FLOOR_SATS_PER_KW</code>, we'll return <code>FEERATE_FLOOR_SATS_PER_KW</code> instead. As with the above, make sure this is added as a method within <code>MyAppFeeEstimator</code>!</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_fee_rate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> confirmation_target<span class="token punctuation">:</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>confirmation_target<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>rate<span class="token closure-punctuation punctuation">|</span></span> <span class="token namespace">cmp<span class="token punctuation">::</span></span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">*</span>rate<span class="token punctuation">,</span> <span class="token constant">FEERATE_FLOOR_SATS_PER_KW</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;all ConfirmationTarget should be present in the cache&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="linking-our-code-to-ldks-feeestimator"><a href="#linking-our-code-to-ldks-feeestimator" class="header-anchor">#</a> Linking Our Code To LDK's <code>FeeEstimator</code></h3> <p>Finally, we'll link our code to LDK's <code>FeeEstimator</code> by specifying that the <code>MyAppFeeEstimator</code> is a concrete implementation of the <code>FeeEstimator</code> and we have satisfied the trait requirement that <code>get_est_sat_per_1000_weight</code> is implemented.</p> <p>Since we've already done most of the work, all we have to do is call the <code>get_fee_rate</code> in our <code>MyAppFeeEstimator</code>, and it will retrieve the feerate for the specified <code>ConfirmationTarget</code>, returning the value in sats/KW (satoshis-per-byte * 250), as specified by the LDK documentation.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span> <span class="token class-name">FeeEstimator</span> <span class="token keyword">for</span> <span class="token class-name">MyAppFeeEstimator</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">get_est_sat_per_1000_weight</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> confirmation_target<span class="token punctuation">:</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">get_fee_rate</span><span class="token punctuation">(</span>confirmation_target<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="testing-and-improving-our-code"><a href="#testing-and-improving-our-code" class="header-anchor">#</a> Testing And Improving Our Code</h3> <p>Now that the <code>MyAppFeeEstimator</code> has been completed, we can  create an instance of the <code>MyAppFeeEstimator</code> and run a few tests.</p> <p>In the below code, we start by creating <code>fee_estimator</code>, an instance of the <code>MyAppFeeEstimator</code>. Remember, since the <code>fee_estimator</code> is originally initialized with default values, we'll have to call <code>update_fees()</code> to fetch feerates from mempool.space and insert those updates into our cache.</p> <p>We then define two fee targets, <code>high_fee_target</code> and <code>low_fee_target</code> for the <code>ConfirmationTarget::UrgentOnChainSweep</code> and <code>ConfirmationTarget::MinAllowedAnchorChannelRemoteFee</code>. Finally, we'll pass these confirmation targets into <code>fee_estimator.get_est_sat_per_1000_weight</code> and print the feerates (sats/KW) to the terminal.</p> <p>One best-practice that was not implemented in this demo but is left as an exercise to the developer is refreshing the updates every 5-10 minutes. One approach toward accomplishing that would be to keep track of the last time the <code>fee_estimator</code> fees were refreshed and create a background process to update those fees periodically. Another exercise that is left to the reader is to create additional functionality within the <code>MyAppFeeEstimator</code> to retrieve the feerate for custom circumstances. For example, you could create a function called <code>get_high_feerate</code>, which takes no arguments and, instead, returns the feerate that should be used for a high-priority transaction. If you'd like to review a production-quality implementation of a <code>FeeEstimator</code>, you can review LDK Node's implementation <a href="https://github.com/lightningdevkit/ldk-node/blob/main/src/fee_estimator.rs" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> fee_estimator <span class="token operator">=</span> <span class="token class-name">MyAppFeeEstimator</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span> fee_estimator<span class="token punctuation">.</span><span class="token function">update_fees</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
        <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to update fees: {}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Example of calling 'get_est_sat_per_1000_weight' with a specific confirmation target</span>
    <span class="token keyword">let</span> high_fee_target <span class="token operator">=</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">UrgentOnChainSweep</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> low_fee_target <span class="token operator">=</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MinAllowedAnchorChannelRemoteFee</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Feerate for {:?}: {:?}&quot;</span><span class="token punctuation">,</span> high_fee_target<span class="token punctuation">,</span> fee_estimator<span class="token punctuation">.</span><span class="token function">get_est_sat_per_1000_weight</span><span class="token punctuation">(</span>high_fee_target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Feerate for {:?}: {:?}&quot;</span><span class="token punctuation">,</span> low_fee_target<span class="token punctuation">,</span> fee_estimator<span class="token punctuation">.</span><span class="token function">get_est_sat_per_1000_weight</span><span class="token punctuation">(</span>low_fee_target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="demo-codebase"><a href="#demo-codebase" class="header-anchor">#</a> Demo Codebase</h3> <p>If you've been following the demo or would like to run/experiment with this code yourself, the entire main.rs file is provided below.</p> <p>Just run <code>$ cargo run</code> in the terminal (from the root directory of this project), and you'll see live fee estimates print to your terminal!</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">lightning<span class="token punctuation">::</span>chain<span class="token punctuation">::</span>chaininterface<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">,</span> <span class="token class-name">FeeEstimator</span><span class="token punctuation">,</span> <span class="token constant">FEERATE_FLOOR_SATS_PER_KW</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token class-name">Deserialize</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>cmp<span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MyAppFeeEstimator</span> <span class="token punctuation">{</span>
    fee_rate_cache<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Deserialize, Debug)]</span>
<span class="token attribute attr-name">#[serde(rename_all = <span class="token string">&quot;camelCase&quot;</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MempoolFeeRate</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> fastest_fee<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> half_hour_fee<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> hour_fee<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> economy_fee<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> minimum_fee<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">MyAppFeeEstimator</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">fetch_fee_from_mempool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">MempoolFeeRate</span><span class="token punctuation">,</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;https://mempool.space/api/v1/fees/recommended&quot;</span><span class="token punctuation">;</span>
        <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Client</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span>
                    <span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">MempoolFeeRate</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token keyword">await</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> fee_rate_cache <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">use</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> target <span class="token keyword">in</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
            <span class="token class-name">MinAllowedAnchorChannelRemoteFee</span><span class="token punctuation">,</span>
            <span class="token class-name">MinAllowedNonAnchorChannelRemoteFee</span><span class="token punctuation">,</span>
            <span class="token class-name">ChannelCloseMinimum</span><span class="token punctuation">,</span>
            <span class="token class-name">AnchorChannelFee</span><span class="token punctuation">,</span>
            <span class="token class-name">NonAnchorChannelFee</span><span class="token punctuation">,</span>
            <span class="token class-name">UrgentOnChainSweep</span><span class="token punctuation">,</span>
            <span class="token class-name">OutputSpendingFee</span><span class="token punctuation">,</span>
            <span class="token class-name">MaximumFeeEstimate</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> default_fee <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">default_fee_from_conf_target</span><span class="token punctuation">(</span><span class="token operator">*</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token operator">*</span>target<span class="token punctuation">,</span> default_fee<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">MyAppFeeEstimator</span> <span class="token punctuation">{</span>
            fee_rate_cache
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">update_fees</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> fee_rates <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">fetch_fee_from_mempool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>

        <span class="token keyword">match</span> fee_rates <span class="token punctuation">{</span>
            <span class="token class-name">Ok</span><span class="token punctuation">(</span>rates<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MaximumFeeEstimate</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>fastest_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">UrgentOnChainSweep</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>fastest_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">OutputSpendingFee</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>fastest_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">NonAnchorChannelFee</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>economy_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">AnchorChannelFee</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>minimum_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">ChannelCloseMinimum</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>minimum_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MinAllowedNonAnchorChannelRemoteFee</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>minimum_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MinAllowedAnchorChannelRemoteFee</span><span class="token punctuation">,</span> rates<span class="token punctuation">.</span>minimum_fee <span class="token operator">*</span> <span class="token number">250</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// If the API call fails, the fallback fees are alreadyy in cache</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_fee_rate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> confirmation_target<span class="token punctuation">:</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>fee_rate_cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>confirmation_target<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>rate<span class="token closure-punctuation punctuation">|</span></span> <span class="token namespace">cmp<span class="token punctuation">::</span></span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">*</span>rate<span class="token punctuation">,</span> <span class="token constant">FEERATE_FLOOR_SATS_PER_KW</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;all ConfirmationTarget should be present in the cache&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">default_fee_from_conf_target</span><span class="token punctuation">(</span>confirmation_target<span class="token punctuation">:</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> confirmation_target <span class="token punctuation">{</span>
            <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MaximumFeeEstimate</span> <span class="token operator">=&gt;</span> <span class="token number">75</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
            <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MinAllowedAnchorChannelRemoteFee</span> <span class="token operator">=&gt;</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
            <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MinAllowedNonAnchorChannelRemoteFee</span> <span class="token operator">=&gt;</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
            <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">ChannelCloseMinimum</span> <span class="token operator">=&gt;</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
            <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">AnchorChannelFee</span> <span class="token operator">=&gt;</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
            <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">NonAnchorChannelFee</span> <span class="token operator">=&gt;</span> <span class="token number">20</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
            <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">UrgentOnChainSweep</span> <span class="token operator">=&gt;</span> <span class="token number">50</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
            <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">OutputSpendingFee</span> <span class="token operator">=&gt;</span> <span class="token number">50</span> <span class="token operator">*</span> <span class="token number">250</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">FeeEstimator</span> <span class="token keyword">for</span> <span class="token class-name">MyAppFeeEstimator</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">get_est_sat_per_1000_weight</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> confirmation_target<span class="token punctuation">:</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">get_fee_rate</span><span class="token punctuation">(</span>confirmation_target<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> fee_estimator <span class="token operator">=</span> <span class="token class-name">MyAppFeeEstimator</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span> fee_estimator<span class="token punctuation">.</span><span class="token function">update_fees</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
        <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to update fees: {}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Example of calling 'get_est_sat_per_1000_weight' with a specific confirmation target</span>
    <span class="token keyword">let</span> high_fee_target <span class="token operator">=</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">UrgentOnChainSweep</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> low_fee_target <span class="token operator">=</span> <span class="token class-name">ConfirmationTarget</span><span class="token punctuation">::</span><span class="token class-name">MinAllowedAnchorChannelRemoteFee</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Feerate for {:?}: {:?}&quot;</span><span class="token punctuation">,</span> high_fee_target<span class="token punctuation">,</span> fee_estimator<span class="token punctuation">.</span><span class="token function">get_est_sat_per_1000_weight</span><span class="token punctuation">(</span>high_fee_target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Feerate for {:?}: {:?}&quot;</span><span class="token punctuation">,</span> low_fee_target<span class="token punctuation">,</span> fee_estimator<span class="token punctuation">.</span><span class="token function">get_est_sat_per_1000_weight</span><span class="token punctuation">(</span>low_fee_target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/lightningdevkit/lightningdevkit.org/edit/main/docs/fee_estimation.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/1/2025, 8:50:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/key_management/" class="prev">
        Key Management
      </a></span> <span class="next"><a href="/probing/">
        Probing and Path Finding
      </a>
      →
    </span></p></div> </main></div></div> <footer class="footer" data-v-b812d5fc><div class="wrap"><div class="wrap-border"><div class="inner"><div class="footer-content"><div class="footer-block"><h4>Docs</h4> <div><a href="/introduction/" class="nav-link">
  Introduction
</a></div><div><a href="/building-a-node-with-ldk/introduction.html" class="nav-link">
  Building a node with LDK
</a></div><div><a href="/running-a-sample-ldk-node/" class="nav-link">
  Running a sample LDK node
</a></div><div><a href="/introduction/architecture/" class="nav-link">
  Architecture
</a></div><div><a href="/blockchain_data/introduction/" class="nav-link">
  Blockchain Data
</a></div><div><a href="/key_management/" class="nav-link">
  Key Management
</a></div><div><a href="/fee_estimation/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Fee Estimation
</a></div><div><a href="/probing/" class="nav-link">
  Probing and Path Finding
</a></div><div><a href="/examples/" class="nav-link">
  Examples
</a></div></div><div class="footer-block"><h4>Community</h4> <div><a href="https://github.com/lightningdevkit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div><a href="https://twitter.com/lightningdevkit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div><a href="https://discord.gg/5AcknnMfBw" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat on Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div><a href="https://calendar.google.com/calendar/embed?src=c_e6fv6vlshbpoob2mmbvblkkoj4%40group.calendar.google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LDK Calendar
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div><a href="http://ldk.reviews/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LDK Review Club
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div><a href="/code-of-conduct/" class="nav-link">
  Code of Conduct
</a></div></div><div class="footer-block"><h4>Resources</h4> <div><a href="/case-studies/" class="nav-link">
  Case Studies
</a></div><div><a href="/blog/" class="nav-link">
  Blog
</a></div></div><div class="footer-block"><h4>Other</h4> <div><a href="https://bitcoindevkit.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bitcoin Dev Kit
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div><a href="https://github.com/lightningdevkit/rust-lightning/blob/main/SECURITY.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Reporting a Vulnerability
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></div></div> <p class="copyright">Copyright © 2025 LDK Developers</p></div></div></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6bc2205c.js" defer></script><script src="/assets/js/10.e6e8a98f.js" defer></script><script src="/assets/js/1.849294d7.js" defer></script><script src="/assets/js/62.73904824.js" defer></script>
  </body>
</html>
